<!DOCTYPE html>
<!-- 
 * Copyright 2014 mark.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * -->
<html>
    <head>
        <title>GC Viewer</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="js/db.js"></script>
        <script src="js/gcEvent.js"></script>
        <script src="js/gcViewerDB.js"></script>
        <script src="js/chart.js"></script>
        <script>
            var db = new GCViewerDB();
            document.onreadystatechange = function () {
                if (document.readyState === 'complete') {
                    db.initDb();
                }
            }

            function processFile() {
                var file = document.getElementById("file").files[0];
                var reader = new FileReader();
                reader.onload = function (e) {
                    var objs = [];
                    var lines = reader.result.split(/\r\n|\r|\n/g);
                    lines.forEach(function (value, index, array) {
                        var obj = parseLogEntry(value);
                        if (obj !== undefined) {
                            objs.push(obj);
                        }
                    });
                    db.updateDataStore(objs);
                };
                reader.onerror = function (e) {
                    document.body.appendChild(document.createTextNode(reader.error));
                };
                reader.readAsText(file);
                return false;
            }

            function drawGraph() {
                drawChart(db, "#chart", "#legend");

            }
            ;

        </script>
        <style>
            .labels>ul{
                width:150px;
                border: 1px solid black;
                text-decoration: none;
                list-style: none;
                padding:0px;
            }
        </style>
    </head>
    <body>
        <form>
            <input type="file" id="file">
            <input type="submit" value="Submit" onclick="return processFile();">
            <input type="button" value="Drop Datastore" onclick="return db.dropDataStore()" />
            <input type="button" value="Create Datastore" onclick="return db.createDataStore()" />
            <input type="button" value="Find Max" onclick="return db.findMax()" />
            <input type="button" value="Draw Graph" onclick="return drawGraph()" />
        </form>
        <div id="chart"></div>
        <div id="legend" class="labels"></div>
    </body>
</html>
